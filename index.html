<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script APEX Optimizer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #0f2027; /* fallback for old browsers */
            background: linear-gradient(to right, #2c5364, #203a43, #0f2027);
            color: #fff;
            animation: fadeIn 1.2s ease-in-out;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        h1 {
            animation: slideIn 1s ease-out;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        p {
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 500px;
            font-family: monospace;
            white-space: pre;
            background-color: #1e1e1e;
            color: #00ffcc;
            border: none;
            padding: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            animation: popIn 1s ease;
            resize: vertical;
        }
        button {
            display: block;
            margin: 20px auto 0;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            background-color: #00c9a7;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            animation: fadeInUp 1.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(0, 201, 167, 0.4);
        }
        button:hover {
            background-color: #007f6a;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .message-box {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #00c9a7;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 201, 167, 0.4);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeInUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 APEX Optimizer v12.0</h1>
        <p>Haz clic en el botón para copiar el script al portapapeles:</p>
        <textarea id="script" readonly>#!/bin/bash
# APEX Optimizer v12.0 - Potencia Extrema
# Autor: candilmartinalonso
# Script de limpieza y optimización del sistema para Android (Termux)
# ¡No requiere ROOT!

# Códigos de color
C_OFF='\033[0m'
C_RED='\033[0;31m'
C_GREEN='\033[0;32m'
C_YELLOW='\033[0;33m'
C_BLUE='\033[0;34m'
C_MAGENTA='\033[0;35m'
C_CYAN='\033[0;36m'
C_WHITE='\033[0;97m'
LOG_FILE=~/apex_auto_log.txt
STORAGE="/sdcard"

# --- Funciones Principales ---

print_banner() {
    clear
    echo -e "$C_RED
    █████╗ ██████╗ ███████╗██╗  ██╗
   ██╔══██╗██╔══██╗██╔════╝╚██╗██╔╝
   ███████║██████╔╝█████╗   ╚███╔╝ 
   ██╔══██║██╔══██╗██╔══╝   ██╔██╗ 
   ██║  ██║██║  ██║███████╗██╔╝ ██╗
   ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝
    $C_WHITE Optimizador APEX v12.0 - Potencia Extrema
    $C_CYAN (c) 2025 candilmartinalonso - Sin Root $C_OFF
"
    echo ""
}

run_deep_clean() {
    echo -e "$C_MAGENTA[MODULO DE LIMPIEZA PROFUNDA]$C_OFF"
    echo -e "$C_YELLOW-> Limpiando caché de apps...$C_OFF"
    find "$STORAGE/Android/data" -type d -name "cache" -exec rm -rf {} + 2>/dev/null
    find "$STORAGE/Android/media" -type d -name "cache" -exec rm -rf {} + 2>/dev/null
    echo -e "$C_YELLOW-> Eliminando archivos basura (.log, .tmp, .bak, .old, .DS_Store)...$C_OFF"
    find "$STORAGE" -type f \( -name "*.log" -o -name "*.tmp" -o -name "*.bak" -o -name "*.old" -o -name "*.DS_Store" \) -delete 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando miniaturas de galería y apps sociales...$C_OFF"
    rm -rf "$STORAGE/DCIM/.thumbnails" 2>/dev/null
    rm -rf "$STORAGE/Pictures/.thumbnails" 2>/dev/null
    rm -rf "$STORAGE/WhatsApp/.Shared" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando APKs descargados...$C_OFF"
    find "$STORAGE/Download" -type f -name "*.apk" -delete 2>/dev/null
    echo -e "$C_YELLOW-> Borrando archivos de apps desinstaladas...$C_OFF"
    find "$STORAGE/Android/data" -maxdepth 1 -type d | while read dir; do
        pkg=$(basename "$dir")
        pm list packages | grep -q "$pkg" || rm -rf "$dir"
    done
    echo -e "$C_YELLOW-> Limpiando logs del sistema y dumps...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.android.*"/*log* 2>/dev/null
    rm -rf "$STORAGE/Android/data/com.android.*"/*dmp* 2>/dev/null
    echo -e "$C_GREEN\nLimpieza profunda completada.$C_OFF"
}

run_social_clean() {
    echo -e "$C_MAGENTA[MODULO DE LIMPIEZA DE RR.SS.]$C_OFF"
    echo -e "$C_YELLOW-> Limpiando backups de WhatsApp...$C_OFF"
    rm -rf "$STORAGE/Android/media/com.whatsapp/WhatsApp/Databases" 2>/dev/null
    rm -rf "$STORAGE/WhatsApp/Databases" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Telegram...$C_OFF"
    rm -rf "$STORAGE/Android/data/org.telegram.messenger/cache" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando miniaturas de WhatsApp...$C_OFF"
    rm -rf "$STORAGE/WhatsApp/Media/.Statuses" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Instagram y TikTok...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.instagram.android/cache" 2>/dev/null
    rm -rf "$STORAGE/Android/data/com.zhiliaoapp.musically/cache" 2>/dev/null
    echo -e "$C_GREEN\nLimpieza de RR.SS. completada.$C_OFF"
}

run_duplicate_clean() {
    echo -e "$C_MAGENTA[BUSCADOR DE ARCHIVOS DUPLICADOS]$C_OFF"
    echo -e "$C_YELLOW-> Nota: Este es un buscador básico. Se recomienda usar una herramienta de PC para una limpieza más exhaustiva.$C_OFF"
    fdupes -r "$STORAGE" | awk 'NF>1' | while read line; do
        echo -e "$C_YELLOW-> Eliminando duplicado: $line$C_OFF"
        rm -f "$line" 2>/dev/null
    done
    echo -e "$C_GREEN\nDuplicados eliminados (básico).$C_OFF"
}

run_empty_folder_clean() {
    echo -e "$C_MAGENTA[CAZADOR DE CARPETAS VACÍAS]$C_OFF"
    echo -e "$C_YELLOW-> Buscando y eliminando directorios vacíos...$C_OFF"
    find "$STORAGE" -type d -empty -delete 2>/dev/null
    echo -e "$C_GREEN\nCaza de carpetas vacías completada.$C_OFF"
}

run_ram_clean() {
    echo -e "$C_MAGENTA[LIMPIEZA DE RAM]$C_OFF"
    echo -e "$C_YELLOW-> Matando procesos zombie y apps en segundo plano...$C_OFF"
    for pkg in $(pm list packages -3 | cut -d: -f2); do am force-stop $pkg 2>/dev/null; done
    echo -e "$C_GREEN\nProcesos finalizados. RAM liberada (si es posible).$C_OFF"
}

run_network_boost() {
    echo -e "$C_MAGENTA[OPTIMIZACIÓN DE RED]$C_OFF"
    echo -e "$C_YELLOW-> Vaciando la caché DNS del sistema...$C_OFF"
    adb shell netd_cmd network flush_dns_cache 2>/dev/null
    echo -e "$C_GREEN\nCaché DNS vaciada (requiere ADB).$C_OFF"
}

run_system_boost() {
    echo -e "$C_MAGENTA[OPTIMIZADOR DEL SISTEMA]$C_OFF"
    run_ram_clean
    run_network_boost
    echo -e "$C_YELLOW-> Ajustando animaciones del sistema...$C_OFF"
    settings put global window_animation_scale 0.25
    settings put global transition_animation_scale 0.25
    settings put global animator_duration_scale 0.25
    echo -e "$C_GREEN\nOptimización avanzada del sistema aplicada.$C_OFF"
}

run_sqlite_opt() {
    echo -e "$C_MAGENTA[OPTIMIZADOR SQLITE]$C_OFF"
    find "$STORAGE" -type f -name "*.db" | while read db; do
        echo -e "$C_YELLOW-> Optimizando $db...$C_OFF"
        sqlite3 "$db" 'VACUUM;' 2>/dev/null
    done
    echo -e "$C_GREEN\nBases de datos SQLite optimizadas.$C_OFF"
}

run_system_diag() {
    echo -e "$C_MAGENTA[DIAGNÓSTICO DEL SISTEMA]$C_OFF"
    echo -e "$C_WHITE  Modelo:$C_OFF $(getprop ro.product.model)"
    echo -e "$C_WHITE  Android:$C_OFF $(getprop ro.build.version.release)"
    echo -e "$C_WHITE  RAM:$C_OFF" && free -m
    echo -e "$C_WHITE  Almacenamiento:$C_OFF" && df -h "$STORAGE"
    echo -e "$C_WHITE  Batería:$C_OFF" && termux-battery-status
    echo -e "$C_WHITE  Temperatura CPU:$C_OFF $(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)"
    echo -e "$C_WHITE  Ciclos batería:$C_OFF $(dumpsys battery | grep cycle 2>/dev/null)"
    echo -e "$C_WHITE  Consumo de apps:$C_OFF"
    dumpsys cpuinfo | head -10 2>/dev/null
    echo -e "$C_WHITE  Estado red:$C_OFF" && ip addr show
}

run_space_by_folder() {
    echo -e "$C_MAGENTA[ESPACIO OCUPADO POR CARPETA]$C_OFF"
    du -hs "$STORAGE"/* 2>/dev/null | sort -hr | head -15
}

# --- Modo Automático ---

run_auto_mode() {
    echo "--- APEX Auto-Clean starting at $(date) ---" >> "$LOG_FILE"
    run_deep_clean >> "$LOG_FILE" 2>&1
    run_social_clean >> "$LOG_FILE" 2>&1
    run_duplicate_clean >> "$LOG_FILE" 2>&1
    run_empty_folder_clean >> "$LOG_FILE" 2>&1
    run_ram_clean >> "$LOG_FILE" 2>&1
    run_network_boost >> "$LOG_FILE" 2>&1
    run_system_boost >> "$LOG_FILE" 2>&1
    run_sqlite_opt >> "$LOG_FILE" 2>&1
    echo "--- APEX Auto-Clean finished at $(date) ---" >> "$LOG_FILE"
    exit 0
}

# --- Menú principal y ejecución ---

main_menu() {
    while true; do
        print_banner
        echo -e "$C_YELLOWElige una opción para optimizar tu dispositivo:$C_OFF"
        echo "  [1] Limpieza Profunda (Caché, Basura, APKs, .old, etc.)"
        echo "  [2] Limpieza de Redes Sociales (WhatsApp, Telegram, Instagram, TikTok)"
        echo "  [3] Limpiar Duplicados"
        echo "  [4] Cazar Carpetas Vacías"
        echo "  [5] Limpieza de RAM y procesos"
        echo "  [6] Optimización de Red (Vaciar caché DNS)"
        echo "  [7] Optimización del Sistema (Animaciones, servicios)"
        echo "  [8] Optimizar Bases de Datos SQLite"
        echo "  [9] Diagnóstico Avanzado del Sistema"
        echo "  [10] Espacio por Carpeta"
        echo -e "$C_CYAN [11] Limpieza TOTAL (Todas las anteriores)$C_OFF"
        echo -e "$C_RED  [q] Salir de APEX$C_OFF"
        echo ""
        read -p "Tu elección: " choice

        case $choice in
            1) print_banner; run_deep_clean ;;
            2) print_banner; run_social_clean ;;
            3) print_banner; run_duplicate_clean ;;
            4) print_banner; run_empty_folder_clean ;;
            5) print_banner; run_ram_clean ;;
            6) print_banner; run_network_boost ;;
            7) print_banner; run_system_boost ;;
            8) print_banner; run_sqlite_opt ;;
            9) print_banner; run_system_diag ;;
            10) print_banner; run_space_by_folder ;;
            11)
                print_banner
                run_deep_clean; echo "";
                run_social_clean; echo "";
                run_duplicate_clean; echo "";
                run_empty_folder_clean; echo "";
                run_ram_clean; echo "";
                run_network_boost; echo "";
                run_system_boost; echo "";
                run_sqlite_opt; echo "";
                ;;
            q|Q) echo -e "$C_CYAN\n¡Gracias por usar APEX! Mantén tu sistema en la cima.$C_OFF"; exit 0 ;;
            *) echo -e "$C_RED\nOpción no válida. Inténtalo de nuevo.$C_OFF"; sleep 1 ;;
        esac
        echo -e "\n$C_WHITE--- Presiona ENTER para volver al menú ---$C_OFF"
        read
    done
}

# Lógica de inicio
if [[ "$1" == "--auto" ]]; then
    run_auto_mode
else
    main_menu
fi
</textarea>
        <button onclick="copyScript()">📋 Copiar Script</button>
        <div id="message-box" class="message-box"></div>
    </div>
    
    <script>
        function copyScript() {
            const script = document.getElementById("script");
            script.select();
            document.execCommand("copy");
            
            const messageBox = document.getElementById("message-box");
            messageBox.textContent = "¡Script copiado al portapapeles!";
            messageBox.classList.add("show");
            
            setTimeout(() => {
                messageBox.classList.remove("show");
            }, 2000);
        }
    </script>
</body>
</html>
