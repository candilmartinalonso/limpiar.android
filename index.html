<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX Optimizer</title>
    <!-- Incluir Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeInUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="font-sans antialiased text-white bg-slate-900 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 animate-[fadeIn_1.2s_ease-in-out]">
    <div class="container mx-auto max-w-4xl p-8 mt-12 bg-white/5 rounded-2xl shadow-xl backdrop-blur-md border border-white/30 animate-[slideIn_1s_ease-out]">
        <h1 class="text-4xl md:text-5xl font-extrabold text-center mb-4 animate-[slideIn_1s_ease-out] drop-shadow-lg">🚀 APEX Optimizer v13.0</h1>
        <p class="text-center text-lg mb-8 animate-[slideIn_1s_ease-out] opacity-80">
            Haz clic en el botón para copiar el script optimizado al portapapeles.
        </p>
        <textarea id="script" readonly
            class="w-full h-[500px] text-base font-mono bg-black/50 text-[#00ffcc] border-none p-6 rounded-xl shadow-inner animate-[popIn_1s_ease] resize-y overflow-auto focus:outline-none">#!/bin/bash
# APEX Optimizer v13.0 - Potencia Extrema
# Autor: candilmartinalonso
#
# AVISO: Este script realiza operaciones destructivas como la eliminación de archivos.
# Úsalo con precaución y bajo tu propia responsabilidad. Algunas funciones pueden
# requerir permisos o utilidades de Termux (como 'fdupes', 'sqlite3', 'adb', 'termux-api').
#
# Script de limpieza y optimización del sistema para Android (Termux)
# ¡No requiere ROOT!

# --- Colores y configuración básica ---
C_OFF='\033[0m'
C_RED='\033[0;31m'
C_GREEN='\033[0;32m'
C_YELLOW='\033[0;33m'
C_BLUE='\033[0;34m'
C_MAGENTA='\033[0;35m'
C_CYAN='\033[0;36m'
C_WHITE='\033[0;97m'
LOG_FILE=~/apex_auto_log.txt
STORAGE="/sdcard"

# --- Funciones Principales ---

# Muestra el banner y el menú principal.
print_banner() {
    clear
    echo -e "$C_RED
    █████╗ ██████╗ ███████╗██╗  ██╗
   ██╔══██╗██╔══██╗██╔════╝╚██╗██╔╝
   ███████║██████╔╝█████╗   ╚███╔╝ 
   ██╔══██║██╔══██╗██╔══╝   ██╔██╗ 
   ██║  ██║██║  ██║███████╗██╔╝ ██╗
   ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝
    $C_WHITE Optimizador APEX v13.0 - Potencia Extrema
    $C_CYAN (c) 2025 candilmartinalonso - Sin Root $C_OFF
"
    echo ""
}

# Realiza una limpieza profunda de archivos basura.
run_deep_clean() {
    echo -e "$C_MAGENTA[MODULO DE LIMPIEZA PROFUNDA]$C_OFF"
    echo -e "$C_YELLOW-> Limpiando caché de apps...$C_OFF"
    find "$STORAGE/Android/data" -type d -name "cache" -exec rm -rf {} + 2>/dev/null
    find "$STORAGE/Android/media" -type d -name "cache" -exec rm -rf {} + 2>/dev/null
    echo -e "$C_YELLOW-> Eliminando archivos basura (.log, .tmp, .bak, .old, .DS_Store)...$C_OFF"
    find "$STORAGE" -type f \( -name "*.log" -o -name "*.tmp" -o -name "*.bak" -o -name "*.old" -o -name "*.DS_Store" \) -delete 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando miniaturas de galería y apps sociales...$C_OFF"
    rm -rf "$STORAGE/DCIM/.thumbnails" 2>/dev/null
    rm -rf "$STORAGE/Pictures/.thumbnails" 2>/dev/null
    rm -rf "$STORAGE/WhatsApp/.Shared" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando APKs descargados...$C_OFF"
    find "$STORAGE/Download" -type f -name "*.apk" -delete 2>/dev/null
    echo -e "$C_YELLOW-> Borrando archivos de apps desinstaladas...$C_OFF"
    find "$STORAGE/Android/data" -maxdepth 1 -type d | while read dir; do
        pkg=$(basename "$dir")
        pm list packages | grep -q "$pkg" || rm -rf "$dir"
    done
    echo -e "$C_YELLOW-> Limpiando logs del sistema y dumps...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.android.*"/*log* 2>/dev/null
    rm -rf "$STORAGE/Android/data/com.android.*"/*dmp* 2>/dev/null
    echo -e "$C_GREEN\nLimpieza profunda completada.$C_OFF"
}

# Limpia los archivos de aplicaciones de redes sociales comunes.
run_social_clean() {
    echo -e "$C_MAGENTA[MODULO DE LIMPIEZA DE RR.SS.]$C_OFF"
    echo -e "$C_YELLOW-> Limpiando backups de WhatsApp...$C_OFF"
    rm -rf "$STORAGE/Android/media/com.whatsapp/WhatsApp/Databases" 2>/dev/null
    rm -rf "$STORAGE/WhatsApp/Databases" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Telegram...$C_OFF"
    rm -rf "$STORAGE/Android/data/org.telegram.messenger/cache" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando miniaturas de WhatsApp...$C_OFF"
    rm -rf "$STORAGE/WhatsApp/Media/.Statuses" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Instagram y TikTok...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.instagram.android/cache" 2>/dev/null
    rm -rf "$STORAGE/Android/data/com.zhiliaoapp.musically/cache" 2>/dev/null
    echo -e "$C_GREEN\nLimpieza de RR.SS. completada.$C_OFF"
}

# Limpia archivos de caché de aplicaciones comunes.
run_common_apps_clean() {
    echo -e "$C_MAGENTA[LIMPIEZA DE APPS COMUNES]$C_OFF"
    echo -e "$C_YELLOW-> Limpiando caché de Google Play Store...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.android.vending/cache" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Chrome y Firefox...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.android.chrome/cache" 2>/dev/null
    rm -rf "$STORAGE/Android/data/org.mozilla.firefox/cache" 2>/dev/null
    echo -e "$C_YELLOW-> Limpiando caché de Spotify y Netflix...$C_OFF"
    rm -rf "$STORAGE/Android/data/com.spotify.music/cache" 2>/dev/null
    rm -rf "$STORAGE/Android/data/com.netflix.mediaclient/cache" 2>/dev/null
    echo -e "$C_GREEN\nLimpieza de apps comunes completada.$C_OFF"
}

# Busca y elimina archivos duplicados (requiere 'fdupes').
run_duplicate_clean() {
    echo -e "$C_MAGENTA[BUSCADOR DE ARCHIVOS DUPLICADOS]$C_OFF"
    if ! command -v fdupes &>/dev/null; then
        echo -e "$C_RED ERROR: 'fdupes' no está instalado. Instálalo con 'pkg install fdupes'.$C_OFF"
        return
    fi
    echo -e "$C_YELLOW-> Nota: Este es un buscador básico. Se recomienda usar una herramienta de PC para una limpieza más exhaustiva.$C_OFF"
    fdupes -r "$STORAGE" | awk 'NF>1' | while read line; do
        echo -e "$C_YELLOW-> Eliminando duplicado: $line$C_OFF"
        rm -f "$line" 2>/dev/null
    done
    echo -e "$C_GREEN\nDuplicados eliminados (básico).$C_OFF"
}

# Elimina archivos multimedia de gran tamaño.
run_large_media_clean() {
    echo -e "$C_MAGENTA[LIMPIEZA DE ARCHIVOS GRANDES]$C_OFF"
    echo -e "$C_YELLOW-> Buscando y eliminando archivos multimedia grandes (> 50MB)...$C_OFF"
    find "$STORAGE" -type f \( -name "*.mp4" -o -name "*.mkv" -o -name "*.avi" -o -name "*.mov" -o -name "*.mp3" -o -name "*.flac" \) -size +50M -print -delete 2>/dev/null
    echo -e "$C_GREEN\nArchivos grandes eliminados.$C_OFF"
}

# Elimina archivos .nomedia para que la galería pueda escanearlos.
run_nomedia_clean() {
    echo -e "$C_MAGENTA[CAZADOR DE ARCHIVOS .nomedia]$C_OFF"
    echo -e "$C_YELLOW-> Buscando y eliminando archivos .nomedia...$C_OFF"
    find "$STORAGE" -type f -name ".nomedia" -delete 2>/dev/null
    echo -e "$C_GREEN\nArchivos .nomedia eliminados. La galería podría ahora mostrar más archivos.$C_OFF"
}

# Elimina carpetas vacías para liberar espacio.
run_empty_folder_clean() {
    echo -e "$C_MAGENTA[CAZADOR DE CARPETAS VACÍAS]$C_OFF"
    echo -e "$C_YELLOW-> Buscando y eliminando directorios vacíos...$C_OFF"
    find "$STORAGE" -type d -empty -delete 2>/dev/null
    echo -e "$C_GREEN\nCaza de carpetas vacías completada.$C_OFF"
}

# Intenta liberar memoria RAM cerrando procesos de usuario.
run_ram_clean() {
    echo -e "$C_MAGENTA[LIMPIEZA DE RAM]$C_OFF"
    echo -e "$C_YELLOW-> Matando procesos zombie y apps en segundo plano...$C_OFF"
    for pkg in $(pm list packages -3 | cut -d: -f2); do am force-stop $pkg 2>/dev/null; done
    echo -e "$C_GREEN\nProcesos finalizados. RAM liberada (si es posible).$C_OFF"
}

# Vacía la caché DNS para una posible mejora de red.
run_network_boost() {
    echo -e "$C_MAGENTA[OPTIMIZACIÓN DE RED]$C_OFF"
    echo -e "$C_YELLOW-> Vaciando la caché DNS del sistema...$C_OFF"
    adb shell netd_cmd network flush_dns_cache 2>/dev/null
    echo -e "$C_GREEN\nCaché DNS vaciada (requiere 'adb' en tu PC y conectividad).$C_OFF"
}

# Ajusta las animaciones del sistema para una sensación más rápida.
run_system_boost() {
    echo -e "$C_MAGENTA[OPTIMIZADOR DEL SISTEMA]$C_OFF"
    run_ram_clean
    run_network_boost
    echo -e "$C_YELLOW-> Ajustando animaciones del sistema...$C_OFF"
    settings put global window_animation_scale 0.25
    settings put global transition_animation_scale 0.25
    settings put global animator_duration_scale 0.25
    echo -e "$C_GREEN\nOptimización avanzada del sistema aplicada.$C_OFF"
}

# Optimiza las bases de datos SQLite (requiere 'sqlite3').
run_sqlite_opt() {
    echo -e "$C_MAGENTA[OPTIMIZADOR SQLITE]$C_OFF"
    if ! command -v sqlite3 &>/dev/null; then
        echo -e "$C_RED ERROR: 'sqlite3' no está instalado. Instálalo con 'pkg install sqlite'.$C_OFF"
        return
    fi
    find "$STORAGE" -type f -name "*.db" | while read db; do
        echo -e "$C_YELLOW-> Optimizando $db...$C_OFF"
        sqlite3 "$db" 'VACUUM;' 2>/dev/null
    done
    echo -e "$C_GREEN\nBases de datos SQLite optimizadas.$C_OFF"
}

# Muestra información detallada del sistema (requiere 'termux-api' y otras utilidades).
run_system_diag() {
    echo -e "$C_MAGENTA[DIAGNÓSTICO DEL SISTEMA]$C_OFF"
    echo -e "$C_WHITE  Modelo:$C_OFF $(getprop ro.product.model)"
    echo -e "$C_WHITE  Android:$C_OFF $(getprop ro.build.version.release)"
    echo -e "$C_WHITE  RAM:$C_OFF" && free -m
    echo -e "$C_WHITE  Almacenamiento:$C_OFF" && df -h "$STORAGE"
    if command -v termux-battery-status &>/dev/null; then
        echo -e "$C_WHITE  Batería:$C_OFF" && termux-battery-status
    fi
    echo -e "$C_WHITE  Temperatura CPU:$C_OFF $(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)"
    echo -e "$C_WHITE  Consumo de apps (top 10):$C_OFF"
    dumpsys cpuinfo | head -10 2>/dev/null
    echo -e "$C_WHITE  Estado red:$C_OFF" && ip addr show
}

# Muestra el espacio ocupado por las carpetas principales.
run_space_by_folder() {
    echo -e "$C_MAGENTA[ESPACIO OCUPADO POR CARPETA]$C_OFF"
    du -hs "$STORAGE"/* 2>/dev/null | sort -hr | head -15
}

# --- Modo Automático ---
run_auto_mode() {
    echo "--- APEX Auto-Clean starting at $(date) ---" >> "$LOG_FILE"
    run_deep_clean >> "$LOG_FILE" 2>&1
    run_social_clean >> "$LOG_FILE" 2>&1
    run_common_apps_clean >> "$LOG_FILE" 2>&1
    run_duplicate_clean >> "$LOG_FILE" 2>&1
    run_large_media_clean >> "$LOG_FILE" 2>&1
    run_nomedia_clean >> "$LOG_FILE" 2>&1
    run_empty_folder_clean >> "$LOG_FILE" 2>&1
    run_ram_clean >> "$LOG_FILE" 2>&1
    run_network_boost >> "$LOG_FILE" 2>&1
    run_system_boost >> "$LOG_FILE" 2>&1
    run_sqlite_opt >> "$LOG_FILE" 2>&1
    echo "--- APEX Auto-Clean finished at $(date) ---" >> "$LOG_FILE"
    exit 0
}

# --- Menú principal y ejecución ---
main_menu() {
    while true; do
        print_banner
        echo -e "$C_YELLOWElige una opción para optimizar tu dispositivo:$C_OFF"
        echo "  [1] Limpieza Profunda"
        echo "  [2] Limpieza de Redes Sociales"
        echo "  [3] Limpiar Apps Comunes"
        echo "  [4] Limpiar Duplicados"
        echo "  [5] Limpiar Archivos Multimedia Grandes (> 50MB)"
        echo "  [6] Eliminar Archivos .nomedia"
        echo "  [7] Cazar Carpetas Vacías"
        echo "  [8] Limpieza de RAM y procesos"
        echo "  [9] Optimización de Red (Vaciar caché DNS)"
        echo "  [10] Optimización del Sistema (Animaciones, servicios)"
        echo "  [11] Optimizar Bases de Datos SQLite"
        echo "  [12] Diagnóstico Avanzado del Sistema"
        echo "  [13] Espacio por Carpeta"
        echo -e "$C_CYAN [14] Limpieza TOTAL (Todas las anteriores)$C_OFF"
        echo -e "$C_RED  [q] Salir de APEX$C_OFF"
        echo ""
        read -p "Tu elección: " choice

        case $choice in
            1) print_banner; run_deep_clean ;;
            2) print_banner; run_social_clean ;;
            3) print_banner; run_common_apps_clean ;;
            4) print_banner; run_duplicate_clean ;;
            5) print_banner; run_large_media_clean ;;
            6) print_banner; run_nomedia_clean ;;
            7) print_banner; run_empty_folder_clean ;;
            8) print_banner; run_ram_clean ;;
            9) print_banner; run_network_boost ;;
            10) print_banner; run_system_boost ;;
            11) print_banner; run_sqlite_opt ;;
            12) print_banner; run_system_diag ;;
            13) print_banner; run_space_by_folder ;;
            14)
                print_banner
                run_deep_clean; echo "";
                run_social_clean; echo "";
                run_common_apps_clean; echo "";
                run_duplicate_clean; echo "";
                run_large_media_clean; echo "";
                run_nomedia_clean; echo "";
                run_empty_folder_clean; echo "";
                run_ram_clean; echo "";
                run_network_boost; echo "";
                run_system_boost; echo "";
                run_sqlite_opt; echo "";
                ;;
            q|Q) echo -e "$C_CYAN\n¡Gracias por usar APEX! Mantén tu sistema en la cima.$C_OFF"; exit 0 ;;
            *) echo -e "$C_RED\nOpción no válida. Inténtalo de nuevo.$C_OFF"; sleep 1 ;;
        esac
        echo -e "\n$C_WHITE--- Presiona ENTER para volver al menú ---$C_OFF"
        read
    done
}

# Lógica de inicio
if [[ "$1" == "--auto" ]]; then
    run_auto_mode
else
    main_menu
fi
        </textarea>
        <button onclick="copyScript()"
            class="block mx-auto mt-6 px-8 py-4 font-bold text-base md:text-lg bg-teal-500 text-white rounded-xl shadow-lg transition-all duration-300 ease-in-out hover:bg-teal-600 hover:scale-105 active:scale-95 animate-[fadeInUp_1.2s_ease-in-out]">
            📋 Copiar Script
        </button>
        <div id="message-box" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-teal-500 text-white px-6 py-3 rounded-lg shadow-2xl opacity-0 transition-opacity duration-500 ease-in-out z-50"></div>
    </div>
    
    <script>
        function copyScript() {
            const script = document.getElementById("script");
            script.select();
            document.execCommand("copy");
            
            const messageBox = document.getElementById("message-box");
            messageBox.textContent = "¡Script copiado al portapapeles!";
            messageBox.classList.add("opacity-100");
            
            setTimeout(() => {
                messageBox.classList.remove("opacity-100");
            }, 2000);
        }
    </script>
</body>
</html>
