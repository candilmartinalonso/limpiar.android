<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX Optimizer v15.0</title>
    <!-- Incluir Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base font-family */
        :root {
            font-family: 'Inter', sans-serif;
        }

        /* Keyframe Definitions */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeInUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Message box transition fix */
        #message-box {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="font-sans antialiased text-white bg-slate-900 bg-gradient-to-br from-slate-900 via-slate-700 to-slate-900 min-h-screen p-4 md:p-8 animate-[fadeIn_1.2s_ease-in-out]">
    <div class="container mx-auto max-w-5xl p-6 mt-6 md:mt-12 bg-white/5 rounded-2xl shadow-2xl backdrop-blur-sm border border-cyan-500/30 animate-[slideIn_1s_ease-out]">
        <h1 class="text-4xl md:text-5xl font-extrabold text-center mb-2 animate-[slideIn_1s_ease-out] drop-shadow-lg text-cyan-400">
            üöÄ APEX Optimizer v15.0
        </h1>
        <p class="text-center text-lg mb-8 animate-[slideIn_1s_ease-out] opacity-70">
            M√°xima eficiencia en Termux. Script refactorizado con logs detallados.
        </p>

        <!-- Script Container -->
        <textarea id="script" readonly
            class="w-full h-[600px] text-sm md:text-base font-mono bg-black/70 text-[#00ffcc] border-2 border-cyan-500/50 p-6 rounded-xl shadow-inner animate-[popIn_1s_ease] resize-y overflow-auto focus:outline-none focus:border-cyan-400">#!/bin/bash
# APEX Optimizer v15.0 - Rendimiento Extremo y Limpieza Modular
# Autor Original: candilmartinalonso
# Mejoras: IA de Google (Especialista en Shell - Refactorizaci√≥n Profunda)
#
# AVISO: Este script realiza operaciones destructivas (borrado).
# √ösalo con precauci√≥n y bajo tu propia responsabilidad.
# No requiere ROOT.
#
# Dependencias recomendadas: fdupes, sqlite (para optimizaci√≥n), termux-api, adb.

# --- Variables y Colores ---
C_OFF='\033[0m'
C_RED='\033[0;31m'
C_GREEN='\033[0;32m'
C_YELLOW='\033[0;33m'
C_BLUE='\033[0;34m'
C_MAGENTA='\033[0;35m'
C_CYAN='\033[0;36m'
C_WHITE='\033[0;97m'
LOG_FILE=~/apex_optimization_v15.log
STORAGE="/sdcard" # Almacenamiento externo

# Inicializa el archivo de log (Borra el log anterior para mantenerlo limpio)
echo "--- APEX Optimizer v15.0 Log Iniciado en $(date) ---" > "$LOG_FILE"

# --- Funciones de Utilidad y Dependencias ---

# Verifica si una utilidad est√° instalada. Solo avisa si falta.
check_dependency() {
    local tool=$1
    if ! command -v "$tool" &>/dev/null; then
        echo -e "$C_YELLOW Advertencia (Dependencia): La herramienta '$tool' no est√° instalada.$C_OFF" | tee -a "$LOG_FILE"
        return 1
    fi
    return 0
}

# Ejecuta un comando, registra el resultado en el log y muestra estado en consola.
execute_module_command() {
    local desc=$1
    local cmd=$2
    echo -e "$C_YELLOW-> $desc...$C_OFF" | tee -a "$LOG_FILE"
    # El uso de 'eval' permite ejecutar comandos complejos o con variables.
    if eval "$cmd" >> "$LOG_FILE" 2>&1; then
        echo -e "$C_GREEN [OK]$C_OFF"
    else
        echo -e "$C_RED [FALLO] (Ver \$LOG_FILE para detalles)$C_OFF"
    fi
}

# Muestra el banner y el men√∫ principal.
print_banner() {
    clear
    echo -e "$C_RED
    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó
   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïù
   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ïö‚ñà‚ñà‚ñà‚ïî‚ïù 
   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù   ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó 
   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïó
   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù
    $C_WHITE Optimizador APEX v15.0 - Rendimiento Extremo
    $C_CYAN (c) 2025 candilmartinalonso - $C_GREEN Scripts m√°s seguros y eficientes $C_OFF
"
    echo ""
}

# --- M√≥dulos de Limpieza y Optimizaci√≥n ---

# 1. Limpieza Profunda de Archivos Basura y Cach√©s Externas
run_deep_clean() {
    echo -e "$C_MAGENTA[MODULO 1: LIMPIEZA PROFUNDA Y RESIDUOS]$C_OFF"
    
    # Cach√©s de Android
    execute_module_command "Limpiando cach√© de apps en /Android/data y /Android/media" "find \"$STORAGE/Android/data\" \"$STORAGE/Android/media\" -type d -name \"cache\" -exec rm -rf {} +"
    
    # Archivos residuales comunes
    execute_module_command "Eliminando logs, temporales, backups comunes" "find \"$STORAGE\" -type f \( -name \"*.log\" -o -name \"*.tmp\" -o -name \"*.bak\" -o -name \"*.old\" -o -name \"*.DS_Store\" -o -name \"crash-*.txt\" \) -delete"

    # Miniaturas de galer√≠a
    execute_module_command "Limpiando miniaturas de galer√≠a" "rm -rf \"$STORAGE/DCIM/.thumbnails\" \"$STORAGE/Pictures/.thumbnails\""
    
    # APKs descargados
    execute_module_command "Eliminando APKs descargados en /Download" "find \"$STORAGE/Download\" -type f -name \"*.apk\" -delete"

    # Archivos de apps desinstaladas
    echo -e "$C_YELLOW-> Intentando limpiar residuos de apps desinstaladas (requiere 'pm')...$C_OFF"
    if check_dependency "pm"; then
        # Itera sobre las carpetas de datos y borra si el paquete no est√° instalado
        find "$STORAGE/Android/data" -maxdepth 1 -type d | while read -r dir; do
            pkg=$(basename "$dir")
            pm list packages | grep -q "$pkg" || rm -rf "$dir" 2>/dev/null
        done
        echo -e "$C_GREEN [OK]$C_OFF"
    else
        echo -e "$C_RED [SALTADO] La utilidad 'pm' no est√° disponible. No se puede verificar la instalaci√≥n.$C_OFF" | tee -a "$LOG_FILE"
    fi

    echo -e "$C_GREEN\nLimpieza profunda completada.$C_OFF"
}

# 2. Limpieza de Redes Sociales (m√°s espec√≠fica)
run_social_clean() {
    echo -e "$C_MAGENTA[MODULO 2: LIMPIEZA DE RR.SS. CR√çTICAS]$C_OFF"
    
    # WhatsApp Databases (suelen ser grandes)
    execute_module_command "Eliminando bases de datos y backups de WhatsApp" "rm -rf \"$STORAGE/Android/media/com.whatsapp/WhatsApp/Databases\" \"$STORAGE/WhatsApp/Databases\""
    
    # Telegram/Instagram/TikTok Cache
    execute_module_command "Limpiando cach√© de Telegram, Instagram y TikTok" "rm -rf \"$STORAGE/Android/data/org.telegram.messenger/cache\" \"$STORAGE/Android/data/com.instagram.android/cache\" \"$STORAGE/Android/data/com.zhiliaoapp.musically/cache\""
    
    # WhatsApp Statuses (Miniaturas temporales)
    execute_module_command "Limpiando miniaturas/statuses de WhatsApp" "rm -rf \"$STORAGE/WhatsApp/Media/.Statuses\""
    
    echo -e "$C_GREEN\nLimpieza de RR.SS. completada.$C_OFF"
}

# 3. Limpieza de Archivos de Logs Generales y Dumps de Errores (NUEVO)
run_log_clean() {
    echo -e "$C_MAGENTA[MODULO 3: LOGS Y DUMPS DE ERRORES]$C_OFF"
    
    # Logs en la ra√≠z de Termux
    execute_module_command "Eliminando logs internos de Termux (~/*.log)" "find \"~\" -maxdepth 1 -name \"*.log\" -delete"
    
    # Logs/Dumps del sistema Android y app-espec√≠ficos
    execute_module_command "Eliminando dumps y logs comunes del sistema Android y apps" "rm -rf \"$STORAGE/Android/data/com.android.*\"/*log* \"$STORAGE/Android/data/com.android.*\"/*dmp* && find \"$STORAGE\" -type f \( -name \"*.trace\" -o -name \"*.dump\" -o -name \"logcat*.txt\" \) -delete"
    
    echo -e "$C_GREEN\nLimpieza de logs completada.$C_OFF"
}

# 4. Buscador y Eliminador de Duplicados
run_duplicate_clean() {
    echo -e "$C_MAGENTA[MODULO 4: BUSCADOR Y ELIMINADOR DE DUPLICADOS]$C_OFF"
    if ! check_dependency "fdupes"; then return; fi

    echo -e "$C_YELLOW-> Buscando duplicados en carpetas clave (DCIM, Download, Pictures)...$C_OFF"
    # fdupes -N elimina autom√°ticamente, preservando la primera copia que encuentra.
    execute_module_command "Ejecutando fdupes para eliminar duplicados autom√°ticamente" "fdupes -r -N \"$STORAGE/DCIM\" \"$STORAGE/Download\" \"$STORAGE/Pictures\""
    
    echo -e "$C_GREEN\nDuplicados eliminados de carpetas multimedia clave.$C_OFF"
}

# 5. Limpieza de Archivos Multimedia Grandes (> 50MB)
run_large_media_clean() {
    echo -e "$C_MAGENTA[MODULO 5: LIMPIEZA DE ARCHIVOS GRANDES (> 50MB)] $C_OFF"
    
    # Solicitud de confirmaci√≥n antes de borrar
    read -r -p "$(echo -e "$C_RED ADVERTENCIA: Esta es una operaci√≥n de BORRADO PERMANENTE de archivos > 50MB. ¬øContinuar? (s/N): $C_OFF")" confirm
    if [[ "$confirm" != "s" && "$confirm" != "S" ]]; then
        echo -e "$C_YELLOW Operaci√≥n cancelada.$C_OFF"
        return
    fi

    # Tipos de archivos: mp4, mkv, avi, mov, mp3, flac, zip, iso.
    execute_module_command "Eliminando archivos grandes y paquetes de instalaci√≥n" "find \"$STORAGE\" -type f \( -name \"*.mp4\" -o -name \"*.mkv\" -o -name \"*.avi\" -o -name \"*.mov\" -o -name \"*.mp3\" -o -name \"*.flac\" -o -name \"*.zip\" -o -name \"*.iso\" \) -size +50M -print -delete"
    
    echo -e "$C_GREEN\nArchivos grandes eliminados.$C_OFF"
}

# 6. Cazador de Archivos .nomedia y Carpetas Vac√≠as
run_empty_folder_clean() {
    echo -e "$C_MAGENTA[MODULO 6: NOMEDIA Y CARPETAS VAC√çAS]$C_OFF"
    
    # 6.1 Elimina archivos .nomedia
    execute_module_command "Borrando archivos .nomedia (para forzar el escaneo de galer√≠a)" "find \"$STORAGE\" -type f -name \".nomedia\" -delete"

    # 6.2 Elimina carpetas vac√≠as
    execute_module_command "Borrando directorios vac√≠os (recursivamente con -depth)" "find \"$STORAGE\" -depth -type d -empty -delete"
    
    echo -e "$C_GREEN\nLimpieza de .nomedia y carpetas vac√≠as completada.$C_OFF"
}

# 7. Limpieza y Optimizaci√≥n de Termux
run_termux_clean() {
    echo -e "$C_MAGENTA[MODULO 7: OPTIMIZACI√ìN DE TERMUX]$C_OFF"
    
    # 7.1 Limpieza de paquetes APT
    execute_module_command "Limpiando cach√© de paquetes APT (pkg clean)" "pkg clean"
    
    # 7.2 Eliminaci√≥n de archivos temporales internos de Termux
    execute_module_command "Eliminando archivos temporales de Termux en \$PREFIX/tmp" "rm -rf \"\$PREFIX/tmp/*\""

    # 7.3 Actualizaci√≥n de repositorios
    execute_module_command "Actualizando la lista de paquetes (pkg update -y)" "pkg update -y"
    
    echo -e "$C_GREEN\nOptimizaci√≥n de Termux completada.$C_OFF"
}

# 8. Limpieza de RAM y Procesos (Limitada sin Root)
run_ram_clean() {
    echo -e "$C_MAGENTA[MODULO 8: LIMPIEZA DE RAM Y PROCESOS]$C_OFF"
    echo -e "$C_YELLOW-> Intentando forzar el cierre de apps de terceros en segundo plano...$C_OFF"
    
    if check_dependency "pm" && check_dependency "am"; then
        # Lista paquetes de terceros y fuerza el cierre
        for pkg in $(pm list packages -3 | cut -d: -f2); do
            am force-stop "$pkg" 2>/dev/null
        done
        echo -e "$C_GREEN [OK] Procesos finalizados (si es posible).$C_OFF"
    else
        echo -e "$C_RED [FALLO] Las utilidades 'pm' o 'am' no est√°n disponibles. No se puede limpiar la RAM.$C_OFF" | tee -a "$LOG_FILE"
    fi
}

# 9. Optimizaci√≥n de Red y Sistema
run_system_boost() {
    echo -e "$C_MAGENTA[MODULO 9: OPTIMIZACI√ìN DE RED Y SISTEMA]$C_OFF"
    
    # 9.1 Vac√≠a la cach√© DNS
    echo -e "$C_YELLOW-> Vaciando la cach√© DNS del sistema...$C_OFF"
    if check_dependency "adb"; then
        execute_module_command "Ejecutando adb shell netd_cmd network flush_dns_cache" "adb shell netd_cmd network flush_dns_cache"
    else
        echo -e "$C_YELLOW [SALTADO] Requiere 'adb' para vaciar la cach√© DNS.$C_OFF" | tee -a "$LOG_FILE"
    fi
    
    # 9.2 Ajusta las animaciones (velocidad percibida)
    echo -e "$C_YELLOW-> Ajustando escalas de animaci√≥n a 0.25x...$C_OFF"
    if check_dependency "settings"; then
        settings put global window_animation_scale 0.25 2>/dev/null
        settings put global transition_animation_scale 0.25 2>/dev/null
        settings put global animator_duration_scale 0.25 2>/dev/null
        echo -e "$C_GREEN [OK] Ajuste de animaciones aplicado.$C_OFF"
    else
        echo -e "$C_YELLOW [SALTADO] Requiere 'settings' para ajustar animaciones.$C_OFF" | tee -a "$LOG_FILE"
    fi
}

# 10. Optimizador de Bases de Datos SQLite
run_sqlite_opt() {
    echo -e "$C_MAGENTA[MODULO 10: OPTIMIZADOR SQLITE (VACUUM)]$C_OFF"
    if ! check_dependency "sqlite3"; then return; fi

    echo -e "$C_YELLOW-> Optimizando todas las bases de datos SQLite (.db) con VACUUM...$C_OFF"
    # VACUUM reconstruye la base de datos para liberar espacio y mejorar el rendimiento de la consulta.
    find "$STORAGE" -type f -name "*.db" | while read -r db; do
        sqlite3 "$db" 'VACUUM;' >> "$LOG_FILE" 2>&1
    done
    
    echo -e "$C_GREEN [OK] Bases de datos SQLite optimizadas.$C_OFF"
}

# 11. Limpieza de Directorios Personalizados (NUEVO INTERACTIVO)
run_custom_clean() {
    echo -e "$C_MAGENTA[MODULO 11: LIMPIEZA PERSONALIZADA]$C_OFF"
    echo -e "$C_YELLOW Ingresa la ruta base (ej: $STORAGE/MisArchivos) y un patr√≥n (ej: *.old) para eliminar archivos.$C_OFF"

    # Uso de read -r para manejar entradas de usuario de forma segura
    read -r -p "$(echo -e "$C_WHITE Ruta Base (ej: $STORAGE): $C_OFF")" base_path
    read -r -p "$(echo -e "$C_WHITE Patr√≥n de Archivo (ej: *.zip, .temp): $C_OFF")" pattern

    if [[ -z "$base_path" ]] || [[ -z "$pattern" ]]; then
        echo -e "$C_RED Error: Ruta o patr√≥n no pueden estar vac√≠os.$C_OFF"
        return
    fi

    # Previsualizaci√≥n de archivos
    echo -e "$C_YELLOW Previsualizando hasta 5 archivos a eliminar en '$base_path' con patr√≥n '$pattern':$C_OFF"
    found_files=$(find "$base_path" -type f -name "$pattern" 2>/dev/null)
    echo "$found_files" | head -5
    
    count=$(echo "$found_files" | wc -l)
    
    if [[ "$count" -eq 0 ]]; then
        echo -e "$C_YELLOW No se encontraron archivos coincidentes.$C_OFF"
        return
    fi
    
    # Confirmaci√≥n
    read -r -p "$(echo -e "$C_RED Se eliminar√°n $count archivos. ¬øConfirmar? (s/N): $C_OFF")" confirm
    if [[ "$confirm" != "s" && "$confirm" != "S" ]]; then
        echo -e "$C_YELLOW Operaci√≥n cancelada.$C_OFF"
        return
    fi

    execute_module_command "Eliminando $count archivos coincidentes" "find \"$base_path\" -type f -name \"$pattern\" -delete"

    echo -e "$C_GREEN\nLimpieza personalizada completada.$C_OFF"
}

# 12. Diagn√≥stico Avanzado del Sistema
run_system_diag() {
    echo -e "$C_MAGENTA[MODULO 12: DIAGN√ìSTICO DEL SISTEMA]$C_OFF"
    
    echo -e "$C_WHITE\n--- Informaci√≥n General ---$C_OFF"
    echo -e "$C_WHITE Modelo:$C_OFF $(getprop ro.product.model 2>/dev/null || echo "N/A")"
    echo -e "$C_WHITE Android:$C_OFF $(getprop ro.build.version.release 2>/dev/null || echo "N/A")"
    
    echo -e "$C_WHITE\n--- Memoria RAM (MB) ---$C_OFF"
    free -m 2>/dev/null || echo "Requiere 'proot' o 'busybox' para 'free'."
    
    echo -e "$C_WHITE\n--- Almacenamiento ($STORAGE) ---$C_OFF"
    df -h "$STORAGE" 2>/dev/null || echo "Comando 'df' no disponible."
    
    if check_dependency "termux-battery-status"; then
        echo -e "$C_WHITE\n--- Estado de la Bater√≠a ---$C_OFF"
        termux-battery-status | grep -E "percentage|status|temperature"
    fi
    
    echo -e "$C_WHITE\n--- Consumo de CPU (Top 10 Apps) ---$C_OFF"
    dumpsys cpuinfo | head -10 2>/dev/null || echo "Requiere acceso a 'dumpsys'."
}

# 13. Espacio Ocupado por Carpeta
run_space_by_folder() {
    echo -e "$C_MAGENTA[MODULO 13: ESPACIO OCUPADO POR CARPETA]$C_OFF"
    echo -e "$C_YELLOW-> Calculando las 15 carpetas m√°s grandes en $STORAGE (esto puede tardar)...$C_OFF"
    du -hs "$STORAGE"/* 2>/dev/null | sort -hr | head -15
    echo -e "$C_GREEN\nFin del reporte de espacio.$C_OFF"
}

# --- Modo Autom√°tico de Ejecuci√≥n Total ---
run_auto_mode() {
    echo "--- APEX Auto-Clean starting at $(date) ---" | tee -a "$LOG_FILE"
    
    # ORDEN DE EJECUCI√ìN: M√≥dulos seguros y eficientes
    run_termux_clean >> "$LOG_FILE" 2>&1
    run_ram_clean >> "$LOG_FILE" 2>&1
    run_system_boost >> "$LOG_FILE" 2>&1
    run_log_clean >> "$LOG_FILE" 2>&1
    run_deep_clean >> "$LOG_FILE" 2>&1
    run_social_clean >> "$LOG_FILE" 2>&1
    run_sqlite_opt >> "$LOG_FILE" 2>&1
    run_empty_folder_clean >> "$LOG_FILE" 2>&1
    
    # Omisi√≥n de Duplicados (4), Archivos Grandes (5) y Personalizada (11) por ser destructivos/interactivos.
    
    echo "--- APEX Auto-Clean finished at $(date) ---" | tee -a "$LOG_FILE"
    exit 0
}

# --- Men√∫ principal y ejecuci√≥n ---
main_menu() {
    while true; do
        print_banner
        echo -e "$C_YELLOWElige una opci√≥n para la Limpieza/Optimizaci√≥n (v15.0):$C_OFF"
        echo "  [ 1] Limpieza Profunda (Cach√©, residuos, apps desinstaladas)"
        echo "  [ 2] Limpieza de Redes Sociales (WhatsApp DBs, Telegram Cache)"
        echo -e "  $C_BLUE[ 3] Limpiar Logs y Dumps de Errores (NUEVO)$C_OFF"
        echo "  [ 4] Limpiar Duplicados (DCIM, Download, Pictures)"
        echo "  [ 5] Limpiar Archivos Multimedia Grandes (> 50MB) - $C_RED ALERTA $C_OFF"
        echo "  [ 6] Cazador de .nomedia y Carpetas Vac√≠as"
        echo "  [ 7] Optimizaci√≥n de Termux (pkg clean, temp, update)"
        echo "  [ 8] Limpieza de RAM y Procesos (Forzar cierre de apps)"
        echo "  [ 9] Optimizaci√≥n de Red/Sistema (DNS, Animaciones 0.25x)"
        echo "  [10] Optimizar Bases de Datos SQLite (VACUUM)"
        echo -e "  $C_BLUE[11] Limpieza Personalizada (Por Ruta y Patr√≥n) $C_OFF"
        echo "  [12] Diagn√≥stico Avanzado del Sistema"
        echo "  [13] Reporte de Espacio por Carpeta (Top 15)"
        echo -e "$C_CYAN [14] Limpieza R√ÅPIDA (Recomendado)$C_OFF"
        echo -e "$C_RED  [q] Salir de APEX$C_OFF"
        echo ""
        # Uso de read -r para manejo seguro de la entrada
        read -r -p "Tu elecci√≥n: " choice

        case $choice in
            1) print_banner; run_deep_clean ;;
            2) print_banner; run_social_clean ;;
            3) print_banner; run_log_clean ;;
            4) print_banner; run_duplicate_clean ;;
            5) print_banner; run_large_media_clean ;;
            6) print_banner; run_empty_folder_clean ;;
            7) print_banner; run_termux_clean ;;
            8) print_banner; run_ram_clean ;;
            9) print_banner; run_system_boost ;;
            10) print_banner; run_sqlite_opt ;;
            11) print_banner; run_custom_clean ;;
            12) print_banner; run_system_diag ;;
            13) print_banner; run_space_by_folder ;;
            14) # Limpieza R√ÅPIDA (Total sin Duplicados/Grandes)
                print_banner
                run_deep_clean; echo ""
                run_social_clean; echo ""
                run_log_clean; echo ""
                run_empty_folder_clean; echo ""
                run_termux_clean; echo ""
                run_ram_clean; echo ""
                run_system_boost; echo ""
                run_sqlite_opt; echo ""
                ;;
            q|Q) echo -e "$C_CYAN\n¬°Gracias por usar APEX v15.0! Sistema en la cima.$C_OFF" | tee -a "$LOG_FILE"; exit 0 ;;
            *) echo -e "$C_RED\nOpci√≥n no v√°lida. Int√©ntalo de nuevo.$C_OFF"; sleep 1 ;;
        esac
        echo -e "\n$C_WHITE--- Presiona ENTER para volver al men√∫ ---$C_OFF"
        read -r
    done
}

# L√≥gica de inicio
if [[ "$1" == "--auto" ]]; then
    run_auto_mode
else
    main_menu
fi
        </textarea>
        <!-- Copy Button -->
        <button onclick="copyScript()"
            class="block mx-auto mt-6 px-10 py-4 font-bold text-base md:text-xl bg-cyan-500 text-white rounded-xl shadow-lg transition-all duration-300 ease-in-out hover:bg-cyan-600 hover:scale-[1.03] active:scale-95 animate-[fadeInUp_1.2s_ease-in-out] border-b-4 border-cyan-700 hover:border-cyan-800">
            üìã Copiar Script APEX v15.0
        </button>
        <!-- Message Box -->
        <div id="message-box" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-green-500/90 text-white px-6 py-3 rounded-xl shadow-2xl opacity-0 transition-opacity duration-300 ease-in-out z-50 font-semibold text-lg"></div>
    </div>
    
    <script>
        // JavaScript para copiar el contenido del script
        function copyScript() {
            const script = document.getElementById("script");
            
            // Seleccionar el contenido
            script.select();
            script.setSelectionRange(0, 99999); // Para dispositivos m√≥viles
            
            // Copiar al portapapeles
            try {
                document.execCommand("copy");
                showNotification("¬°Script copiado al portapapeles!", 'bg-cyan-500/90');
            } catch (err) {
                console.error("No se pudo copiar el texto:", err);
                showNotification("Error: No se pudo copiar. Int√©ntalo manualmente.", 'bg-red-500/90');
            }
        }

        // Funci√≥n para mostrar la notificaci√≥n
        function showNotification(message, colorClass = 'bg-cyan-500/90') {
            const messageBox = document.getElementById("message-box");
            
            // Resetear clases de color y aplicar el nuevo mensaje y color
            messageBox.className = "fixed bottom-8 left-1/2 -translate-x-1/2 text-white px-6 py-3 rounded-xl shadow-2xl opacity-0 transition-opacity duration-300 ease-in-out z-50 font-semibold text-lg";
            messageBox.classList.add(colorClass);
            messageBox.textContent = message;
            
            // Mostrar
            messageBox.classList.add("opacity-100");
            messageBox.classList.remove("-translate-x-1/2");
            
            // Ocultar despu√©s de 2 segundos
            setTimeout(() => {
                messageBox.classList.remove("opacity-100");
            }, 2000);
        }
    </script>
</body>
</html>
