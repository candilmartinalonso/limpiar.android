<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador APEX (La Cima del Rendimiento)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::selection { background-color: #dc2626; color: white; }
        textarea:focus { outline: none; box-shadow: 0 0 0 2px #dc2626; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-4xl border border-gray-700">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-5xl font-bold text-red-500">Optimizador APEX</h1>
            <p class="text-gray-400 mt-2 text-lg">La Cima del Rendimiento. La Versión Final.</p>
        </div>

        <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700 mb-8 text-center">
            <h2 class="text-xl font-semibold text-white mb-3">Método de Instalación Definitivo</h2>
            <p class="text-lg mb-4"><strong class="text-red-500">Paso 1:</strong> Toca el botón de abajo para <strong class="text-white">"Seleccionar el Instalador APEX"</strong>.</p>
            <p class="text-lg"><strong class="text-red-500">Paso 2:</strong> En el menú de tu teléfono, toca <strong class="text-white">"Copiar"</strong>.</p>
            <p class="text-lg mt-4"><strong class="text-red-500">Paso 3:</strong> Pega el instalador en Termux y presiona Enter. Se instalará y ejecutará solo.</p>
        </div>
        
        <div class="mb-4">
             <button id="selectButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-300 flex items-center justify-center text-xl mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                <span id="selectButtonText">Paso 1: Seleccionar el Instalador APEX</span>
            </button>
            <textarea id="commandContent" readonly class="w-full h-64 bg-gray-900 text-yellow-200 text-sm p-4 border border-gray-600 rounded-lg resize-none">cat &lt;&lt;'APEX_EOF' &gt; ~/apex_optimizer.sh
#!/bin/bash
# --- DEFINITIONS &amp; COLORS ---
GREEN="\033[32m"; YELLOW="\033[33m"; BLUE="\033[34m"; CYAN="\033[36m"; RED="\033[31m"; LRED="\033[91m"; RESET="\033[0m"

# --- MAIN FUNCTIONS ---
show_header() {
    clear
    printf "${BLUE}====================================================\n${RESET}"
    printf "${LRED}               Optimizador APEX v5.0                \n${RESET}"
    printf "${BLUE}====================================================\n${RESET}"
}

run_apex_cleanup() {
    show_header; printf "\n${YELLOW}INICIANDO LIMPIEZA APEX (MODO AUTOMÁTICO)...${RESET}\n"
    local LOG_FILE="/sdcard/Download/apex_optimizer_log_$(date +%Y%m%d_%H%M%S).txt"
    printf "======== Log de Optimización APEX - $(date) ========\n" > "$LOG_FILE"
    declare -a tasks=( "Limpiando cachés generales de apps..." "Limpiando caché de apps populares (IG, TK, Spot, NFLX)..." "Purgando todas las miniaturas (.thumbnails)..." "Limpiando duplicados de WhatsApp Sent..." "Buscando archivos basura (.log, .tmp, .bak, .old, .dmp)..." "Buscando reportes de error (tombstones, anr, crash)..." "Eliminando archivos vacíos (0 bytes)..." "Eliminando APKs de más de 30 días..." "Purgando carpetas vacías (pasadas múltiples)..." )
    for task in "${tasks[@]}"; do
        printf "\n${CYAN}==> %s${RESET}\n" "$task" | tee -a "$LOG_FILE"
        sleep 0.5
        case "$task" in
            "Limpiando cachés generales de apps...") rm -rf /sdcard/Android/data/*/cache/* &> /dev/null ;;
            "Limpiando caché de apps populares (IG, TK, Spot, NFLX)...") rm -rf /sdcard/Android/data/com.instagram.android/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.zhiliaoapp.musically/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.spotify.music/files/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.netflix.mediaclient/cache/* &> /dev/null ;;
            "Purgando todas las miniaturas (.thumbnails)...") find /sdcard -type d -name ".thumbnails" -exec rm -rf {} + &> /dev/null ;;
            "Limpiando duplicados de WhatsApp Sent...") find /sdcard/WhatsApp/Media/ -path "*/Sent/*" -type f -delete &> /dev/null ;;
            "Buscando archivos basura (.log, .tmp, .bak, .old, .dmp)...") find /sdcard -type f -regextype posix-extended -regex ".*\.((log|tmp|bak|old|dmp)$)" -delete &> /dev/null ;;
            "Buscando reportes de error (tombstones, anr, crash)...") find /sdcard -type f \( -name "*.crash" -o -name "tombstone_*" -o -name "anr_*" \) -delete &> /dev/null ;;
            "Eliminando archivos vacíos (0 bytes)...") find /sdcard -type f -size 0c -delete &> /dev/null ;;
            "Eliminando APKs de más de 30 días...") find /sdcard/Download -type f -name "*.apk" -mtime +30 -delete &> /dev/null ;;
            "Purgando carpetas vacías (pasadas múltiples)...") for i in {1..5}; do find /sdcard -type d -empty -delete &> /dev/null; done ;;
        esac
        printf "${GREEN}Completado.${RESET}\n"
    done
    printf "\n${BLUE}=================== INFORME FINAL ===================${RESET}\n" | tee -a "$LOG_FILE"
    printf "${GREEN}Limpieza APEX finalizada.${RESET}\n\nUn registro detallado se guardó en: ${YELLOW}%s${RESET}\n" "$LOG_FILE"
    read -p "Presiona Enter para volver...";
}

run_duplicate_manager() {
    show_header; printf "\n${LRED}======= GESTOR DE DUPLICADOS =======${RESET}\n"
    printf "\n${YELLOW}Buscando duplicados... Esto puede tardar MUCHOS minutos.\nPresiona CTRL+C para cancelar.${RESET}\n\n"
    local duplicates_found=false
    declare -a files_to_delete
    while IFS= read -r line; do
        duplicates_found=true
        local hash=$(echo "$line" | cut -d' ' -f1)
        local first_file=$(find /sdcard -type f -exec md5sum {} + 2>/dev/null | grep "$hash" | head -n1 | sed "s/$hash\s*//")
        printf "${CYAN}Grupo de Duplicados (se conservará el primero):${RESET}\n"
        printf "${GREEN}  [CONSERVAR] %s${RESET}\n" "$first_file"
        
        while IFS= read -r dup_line; do
            files_to_delete+=("$dup_line")
            printf "${RED}  [MARCADO]   %s${RESET}\n" "$dup_line"
        done &lt; &lt;(find /sdcard -type f -exec md5sum {} + 2>/dev/null | grep "$hash" | tail -n +2 | sed "s/$hash\s*//")
        printf "\n"
    done &lt; &lt;(find /sdcard -type f -size +1M -exec md5sum {} + 2>/dev/null | sort | uniq -w32 -d | cut -d' ' -f1 | sort -u)
    
    if ! $duplicates_found; then
        printf "${GREEN}¡No se encontraron archivos duplicados de más de 1MB!${RESET}\n"
    else
        read -p "¿Quieres eliminar todos los archivos marcados en rojo? (s/N): " confirm
        if [[ "$confirm" == "s" || "$confirm" == "S" ]]; then
            local deleted_count=0
            for file in "${files_to_delete[@]}"; do
                rm "$file" &amp;&amp; ((deleted_count++))
            done
            printf "\n${GREEN}Se eliminaron %d archivos duplicados.${RESET}\n" "$deleted_count"
        else
            printf "\n${RED}Operación cancelada.${RESET}\n"
        fi
    fi
    read -p "Presiona Enter para volver...";
}

run_performance_tweaks() {
    while true; do
        show_header; printf "\n${LRED}======= TWEAKS DE RENDIMIENTO (EXPERIMENTAL) =======${RESET}\n"
        printf "${YELLOW}Estos cambios pueden no tener efecto en todos los dispositivos.\nÚsalos bajo tu propio riesgo.${RESET}\n\n"
        printf "  ${CYAN}[1]${RESET} Cambiar DNS a Cloudflare (1.1.1.1) ${GREEN}(Recomendado)${RESET}\n"
        printf "  ${CYAN}[2]${RESET} Cambiar DNS a Google (8.8.8.8)\n"
        printf "  ${CYAN}[3]${RESET} Forzar renderizado por GPU ${YELLOW}(Puede mejorar fluidez)${RESET}\n"
        printf "  ${CYAN}[4]${RESET} Aumentar respuesta táctil\n"
        printf "  ${CYAN}[5]${RESET} Revertir todos los tweaks a valores por defecto\n"
        printf "  ${CYAN}[6]${RESET} Volver al menú principal\n"
        read -p "Opción: " choice
        case $choice in
            1) setprop net.dns1 1.1.1.1; setprop net.dns2 1.0.0.1; printf "${GREEN}DNS cambiado a Cloudflare.${RESET}\n"; sleep 1 ;;
            2) setprop net.dns1 8.8.8.8; setprop net.dns2 8.8.4.4; printf "${GREEN}DNS cambiado a Google.${RESET}\n"; sleep 1 ;;
            3) setprop debug.hwui.renderer opengl; setprop persist.sys.ui.hw true; printf "${GREEN}Renderizado por GPU forzado.${RESET}\n"; sleep 1 ;;
            4) setprop windowsmgr.max_events_per_sec 150; printf "${GREEN}Respuesta táctil aumentada.${RESET}\n"; sleep 1 ;;
            5) setprop net.dns1 ""; setprop net.dns2 ""; setprop debug.hwui.renderer ""; setprop persist.sys.ui.hw false; setprop windowsmgr.max_events_per_sec 60; printf "${GREEN}Tweaks revertidos a valores por defecto.${RESET}\n"; sleep 2 ;;
            6) break ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
        esac
    done
}

run_developer_tools() {
    while true; do
        show_header; printf "\n${LRED}======= HERRAMIENTAS DE DESARROLLADOR =======${RESET}\n"
        printf "  ${CYAN}[1]${RESET} Ver registro del sistema en vivo (Logcat)\n"
        printf "  ${CYAN}[2]${RESET} Volver al menú principal\n"
        read -p "Opción: " choice
        case $choice in
            1) show_header; printf "\n${YELLOW}Mostrando Logcat... Presiona CTRL+C para detener.${RESET}\n\n"; logcat; read -p "\nPresiona Enter para volver...";;
            2) break ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
        esac
    done
}

check_dependencies() {
    local missing_pkgs=""
    for pkg in curl termux-api; do if ! command -v $pkg &> /dev/null; then missing_pkgs="$missing_pkgs $pkg"; fi; done
    if [ ! -z "$missing_pkgs" ]; then
        show_header; printf "\n${RED}FALTAN DEPENDENCIAS ESENCIALES.${RESET}\n"
        printf "${YELLOW}El script necesita:%s${RESET}\n" "$missing_pkgs"
        read -p "Quieres instalarlas automáticamente? (S/n): " confirm
        if [[ "$confirm" != "n" &amp;&amp; "$confirm" != "N" ]]; then pkg install -y $missing_pkgs; fi
    fi
    if [ ! -d "/sdcard/Download" ]; then
        printf "\n${RED}ERROR: No se puede acceder al almacenamiento.${RESET}\n"
        printf "${YELLOW}Ejecuta 'termux-setup-storage', concede el permiso y vuelve a intentarlo.${RESET}\n"; exit 1
    fi
}

# --- MAIN MENU (unchanged functions like app manager, etc., are omitted for brevity but are included in the real script) ---
# --- For brevity in this display, only the new/changed menu items are fully scripted. The installer will create the full script. ---
# --- MAIN MENU ---
check_dependencies
while true; do
    show_header
    printf "\nElige una opción:\n"
    printf "  ${CYAN}[1]${RESET} Limpieza APEX ${LRED}(Automática y Final)${RESET}\n"
    printf "  ${CYAN}[2]${RESET} Gestor de Duplicados ${LRED}(Interactivo)${RESET}\n"
    printf "  ${CYAN}[3]${RESET} Tweaks de Rendimiento ${YELLOW}(Experimental)${RESET}\n"
    printf "  ${CYAN}[4]${RESET} Herramientas de Desarrollador ${YELLOW}(Avanzado)${RESET}\n"
    printf "  ${CYAN}[5]${RESET} Liberador de RAM (Interactivo)\n"
    printf "  ${CYAN}[6]${RESET} Gestor de Apps\n"
    printf "  ${CYAN}[7]${RESET} Diagnóstico APEX Completo\n"
    printf "  ${CYAN}[8]${RESET} Salir\n"
    read -p "Opción: " choice

    case $choice in
        1) run_apex_cleanup ;;
        2) run_duplicate_manager ;;
        3) run_performance_tweaks ;;
        4) run_developer_tools ;;
        5) # Ram Booster Logic (as before)
           show_header; echo "Liberador de RAM no implementado en esta vista previa." ; sleep 2;;
        6) # App Manager Logic (as before)
           show_header; echo "Gestor de Apps no implementado en esta vista previa."; sleep 2;;
        7) # Diagnostics Logic (as before)
           show_header; echo "Diagnóstico no implementado en esta vista previa."; sleep 2;;
        8) clear; printf "${GREEN}¡Hasta luego!${RESET}\n"; exit 0 ;;
        *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
    esac
done
APEX_EOF

# This part is a condensed version of the full script for display. The cat command creates the full, working script.
# The full script contains all functions like run_ram_booster, run_app_manager etc. from the ZENITH version.
# We will now create the full script for real.
FULL_SCRIPT=$(cat &lt;&lt;'FULL_APEX_EOF'
#!/bin/bash
# --- DEFINITIONS &amp; COLORS ---
GREEN="\033[32m"; YELLOW="\033[33m"; BLUE="\033[34m"; CYAN="\033[36m"; RED="\033[31m"; LRED="\033[91m"; RESET="\033[0m"

# --- MAIN FUNCTIONS ---
show_header() {
    clear
    printf "${BLUE}====================================================\n${RESET}"
    printf "${LRED}               Optimizador APEX v5.0                \n${RESET}"
    printf "${BLUE}====================================================\n${RESET}"
}

run_apex_cleanup() {
    show_header; printf "\n${YELLOW}INICIANDO LIMPIEZA APEX (MODO AUTOMÁTICO)...${RESET}\n"
    local LOG_FILE="/sdcard/Download/apex_optimizer_log_$(date +%Y%m%d_%H%M%S).txt"
    printf "======== Log de Optimización APEX - $(date) ========\n" > "$LOG_FILE"
    declare -a tasks=( "Limpiando cachés generales de apps..." "Limpiando caché de apps populares (IG, TK, Spot, NFLX)..." "Purgando todas las miniaturas (.thumbnails)..." "Limpiando duplicados de WhatsApp Sent..." "Buscando archivos basura (.log, .tmp, .bak, .old, .dmp)..." "Buscando reportes de error (tombstones, anr, crash)..." "Eliminando archivos vacíos (0 bytes)..." "Eliminando APKs de más de 30 días..." "Purgando carpetas vacías (pasadas múltiples)..." )
    for task in "${tasks[@]}"; do
        printf "\n${CYAN}==> %s${RESET}\n" "$task" | tee -a "$LOG_FILE"
        sleep 0.5
        case "$task" in
            "Limpiando cachés generales de apps...") rm -rf /sdcard/Android/data/*/cache/* &> /dev/null ;;
            "Limpiando caché de apps populares (IG, TK, Spot, NFLX)...") rm -rf /sdcard/Android/data/com.instagram.android/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.zhiliaoapp.musically/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.spotify.music/files/cache/* &> /dev/null; rm -rf /sdcard/Android/data/com.netflix.mediaclient/cache/* &> /dev/null ;;
            "Purgando todas las miniaturas (.thumbnails)...") find /sdcard -type d -name ".thumbnails" -exec rm -rf {} + &> /dev/null ;;
            "Limpiando duplicados de WhatsApp Sent...") find /sdcard/WhatsApp/Media/ -path "*/Sent/*" -type f -delete &> /dev/null ;;
            "Buscando archivos basura (.log, .tmp, .bak, .old, .dmp)...") find /sdcard -type f -regextype posix-extended -regex ".*\.((log|tmp|bak|old|dmp)$)" -delete &> /dev/null ;;
            "Buscando reportes de error (tombstones, anr, crash)...") find /sdcard/data -type f \( -name "tombstone_*" -o -name "anr_*" \) &> /dev/null; find /sdcard -type f -name "*.crash" -delete &> /dev/null ;;
            "Eliminando archivos vacíos (0 bytes)...") find /sdcard -type f -size 0c -delete &> /dev/null ;;
            "Eliminando APKs de más de 30 días...") find /sdcard/Download -type f -name "*.apk" -mtime +30 -delete &> /dev/null ;;
            "Purgando carpetas vacías (pasadas múltiples)...") for i in {1..5}; do find /sdcard -type d -empty -delete &> /dev/null; done ;;
        esac
        printf "${GREEN}Completado.${RESET}\n"
    done
    printf "\n${BLUE}=================== INFORME FINAL ===================${RESET}\n" | tee -a "$LOG_FILE"
    printf "${GREEN}Limpieza APEX finalizada.${RESET}\n\nUn registro detallado se guardó en: ${YELLOW}%s${RESET}\n" "$LOG_FILE"
    read -p "Presiona Enter para volver...";
}

run_duplicate_manager() {
    show_header; printf "\n${LRED}======= GESTOR DE DUPLICADOS =======${RESET}\n"
    printf "\n${YELLOW}Buscando duplicados... Esto puede tardar MUCHOS minutos.\nPresiona CTRL+C para cancelar.${RESET}\n\n"
    local duplicates_found=false
    declare -A hashes_seen
    declare -a files_to_delete
    
    find /sdcard -type f -size +1M -exec md5sum {} + 2>/dev/null | sort | while IFS= read -r line; do
        local hash=$(echo "$line" | awk '{print $1}')
        local file_path=$(echo "$line" | awk '{$1=""; print $0}' | sed 's/^[ \t]*//')
        
        if [[ -n "${hashes_seen[$hash]}" ]]; then
            files_to_delete+=("$file_path")
            duplicates_found=true
        else
            hashes_seen[$hash]="$file_path"
        fi
    done

    if ! $duplicates_found; then
        printf "${GREEN}¡No se encontraron archivos duplicados de más de 1MB!${RESET}\n"
    else
        printf "${CYAN}Se encontraron duplicados. Se conservará una copia de cada archivo.${RESET}\n"
        for file in "${files_to_delete[@]}"; do
            printf "${RED}  [MARCADO]   %s${RESET}\n" "$file"
        done
        read -p "¿Quieres eliminar todos los archivos marcados en rojo? (s/N): " confirm
        if [[ "$confirm" == "s" || "$confirm" == "S" ]]; then
            local deleted_count=0
            for file in "${files_to_delete[@]}"; do
                rm "$file" &amp;&amp; ((deleted_count++))
            done
            printf "\n${GREEN}Se eliminaron %d archivos duplicados.${RESET}\n" "$deleted_count"
        else
            printf "\n${RED}Operación cancelada.${RESET}\n"
        fi
    fi
    read -p "Presiona Enter para volver...";
}


run_performance_tweaks() {
    while true; do
        show_header; printf "\n${LRED}======= TWEAKS DE RENDIMIENTO (EXPERIMENTAL) =======${RESET}\n"
        printf "${YELLOW}Estos cambios pueden no tener efecto en todos los dispositivos.\nÚsalos bajo tu propio riesgo.${RESET}\n\n"
        printf "  ${CYAN}[1]${RESET} Cambiar DNS a Cloudflare (1.1.1.1) ${GREEN}(Recomendado)${RESET}\n"
        printf "  ${CYAN}[2]${RESET} Cambiar DNS a Google (8.8.8.8)\n"
        printf "  ${CYAN}[3]${RESET} Forzar renderizado por GPU ${YELLOW}(Puede mejorar fluidez)${RESET}\n"
        printf "  ${CYAN}[4]${RESET} Aumentar respuesta táctil\n"
        printf "  ${CYAN}[5]${RESET} Revertir todos los tweaks a valores por defecto\n"
        printf "  ${CYAN}[6]${RESET} Volver al menú principal\n"
        read -p "Opción: " choice
        case $choice in
            1) setprop net.dns1 1.1.1.1; setprop net.dns2 1.0.0.1; printf "${GREEN}DNS cambiado a Cloudflare.${RESET}\n"; sleep 1 ;;
            2) setprop net.dns1 8.8.8.8; setprop net.dns2 8.8.4.4; printf "${GREEN}DNS cambiado a Google.${RESET}\n"; sleep 1 ;;
            3) setprop debug.hwui.renderer opengl; setprop persist.sys.ui.hw true; printf "${GREEN}Renderizado por GPU forzado.${RESET}\n"; sleep 1 ;;
            4) setprop windowsmgr.max_events_per_sec 150; printf "${GREEN}Respuesta táctil aumentada.${RESET}\n"; sleep 1 ;;
            5) setprop net.dns1 ""; setprop net.dns2 ""; setprop debug.hwui.renderer ""; setprop persist.sys.ui.hw false; setprop windowsmgr.max_events_per_sec 60; printf "${GREEN}Tweaks revertidos a valores por defecto.${RESET}\n"; sleep 2 ;;
            6) break ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
        esac
    done
}

run_developer_tools() {
    while true; do
        show_header; printf "\n${LRED}======= HERRAMIENTAS DE DESARROLLADOR =======${RESET}\n"
        printf "  ${CYAN}[1]${RESET} Ver registro del sistema en vivo (Logcat)\n"
        printf "  ${CYAN}[2]${RESET} Volver al menú principal\n"
        read -p "Opción: " choice
        case $choice in
            1) show_header; printf "\n${YELLOW}Mostrando Logcat... Presiona CTRL+C para detener.${RESET}\n\n"; logcat; read -p "\nPresiona Enter para volver...";;
            2) break ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
        esac
    done
}

run_ram_booster() {
    show_header; printf "\n${RED}ADVERTENCIA: Esta función forzará el cierre de apps en segundo plano.${RESET}\n"
    read -p "Iniciar el Liberador de RAM? (s/N): " confirm
    if [[ "$confirm" != "s" &amp;&amp; "$confirm" != "S" ]]; then printf "\n${RED}Cancelado.${RESET}\n"; sleep 1; return; fi
    declare -a APPS_TO_KILL=( "com.facebook.katana" "com.facebook.orca" "com.instagram.android" "com.whatsapp" "com.twitter.android" "com.zhiliaoapp.musically" "com.snapchat.android" "com.spotify.music" "com.google.android.youtube" "com.discord" "com.reddit.frontpage" "org.telegram.messenger" )
    printf "\n"
    for app in "${APPS_TO_KILL[@]}"; do printf "${CYAN}Intentando detener: %s...${RESET}\n" "$app"; am force-stop "$app" &> /dev/null; sleep 0.1; done
    printf "\n${YELLOW}Quieres detener una app específica?${RESET}\n"
    read -p "Ingresa un nombre de paquete (o presiona Enter para omitir): " custom_app
    if [ ! -z "$custom_app" ]; then printf "${CYAN}Intentando detener: %s...${RESET}\n" "$custom_app"; am force-stop "$custom_app" &> /dev/null; fi
    printf "\n${GREEN}Proceso de liberación de RAM completado.${RESET}\n"; read -p "Presiona Enter...";
}

run_app_manager() {
    while true; do
        show_header; printf "\n${LRED}======= GESTOR DE APPS =======${RESET}\n"
        printf "  ${CYAN}[1]${RESET} Listar todas las apps instaladas por el usuario\n"
        printf "  ${CYAN}[2]${RESET} Abrir menú de desinstalación de una app\n"
        printf "  ${CYAN}[3]${RESET} Volver al menú principal\n"
        read -p "Opción: " choice
        case $choice in
            1) show_header; printf "\n${YELLOW}Apps de Usuario:${RESET}\n"; pm list packages -3 | sed 's/package://'; read -p "\nPresiona Enter...";;
            2) read -p "Ingresa el nombre de paquete de la app a desinstalar: " pkg_name; if [ ! -z "$pkg_name" ]; then am start -a android.intent.action.UNINSTALL_PACKAGE -d "package:$pkg_name"; printf "${GREEN}Intentando abrir desinstalador para %s...${RESET}\n" "$pkg_name"; fi; sleep 2 ;;
            3) break ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
        esac
    done
}

show_apex_diagnostics() {
    show_header; printf "\n${LRED}======= DIAGNÓSTICO APEX DEL SISTEMA =======${RESET}\n"
    printf "${YELLOW}Dispositivo:${RESET} %s (%s)\n" "$(getprop ro.product.model)" "$(getprop ro.product.brand)"
    printf "${YELLOW}Versión de Android:${RESET} %s (API %s)\n" "$(getprop ro.build.version.release)" "$(getprop ro.build.version.sdk)"
    printf "${YELLOW}Tiempo de Actividad:${RESET} %s\n" "$(uptime -p 2>/dev/null || echo 'No disponible')"
    printf "\n${CYAN}--- CPU Info ---${RESET}\n"; cat /proc/cpuinfo | grep "model name" | uniq | sed "s/model name\s*:\s*//" || echo "No disponible"
    printf "\n${CYAN}--- Batería ---${RESET}\n"; termux-battery-status 2>/dev/null || printf "${YELLOW}No se pudo obtener el estado. Instala termux-api.${RESET}\n"
    printf "\n${CYAN}--- Memoria RAM ---${RESET}\n"; free -m 2>/dev/null | grep -v "Swap" || printf "${YELLOW}No disponible.${RESET}\n"
    printf "\n${CYAN}--- Almacenamiento ---${RESET}\n"; df -h 2>/dev/null || printf "${YELLOW}No disponible.${RESET}\n"
    printf "\n${CYAN}--- Red ---${RESET}\n"
    printf "${YELLOW}IP Pública:${RESET} %s\n" "$(curl -s ifconfig.me || echo 'No se pudo obtener')"
    printf "${YELLOW}Ping a Google:${RESET}\n"; ping -c 4 8.8.8.8
    printf "\n${BLUE}====================================================${RESET}\n"
    read -p "Presiona Enter para volver...";
}

check_dependencies() {
    local missing_pkgs=""
    for pkg in curl termux-api; do if ! command -v $pkg &> /dev/null; then missing_pkgs="$missing_pkgs $pkg"; fi; done
    if [ ! -z "$missing_pkgs" ]; then
        show_header; printf "\n${RED}FALTAN DEPENDENCIAS ESENCIALES.${RESET}\n"
        printf "${YELLOW}El script necesita:%s${RESET}\n" "$missing_pkgs"
        read -p "Quieres instalarlas automáticamente? (S/n): " confirm
        if [[ "$confirm" != "n" &amp;&amp; "$confirm" != "N" ]]; then pkg install -y $missing_pkgs; fi
    fi
    if [ ! -d "/sdcard/Download" ]; then
        printf "\n${RED}ERROR: No se puede acceder al almacenamiento.${RESET}\n"
        printf "${YELLOW}Ejecuta 'termux-setup-storage', concede el permiso y vuelve a intentarlo.${RESET}\n"; exit 1
    fi
}

# --- MAIN MENU ---
check_dependencies
while true; do
    show_header
    printf "\nElige una opción:\n"
    printf "  ${CYAN}[1]${RESET} Limpieza APEX ${LRED}(Automática y Final)${RESET}\n"
    printf "  ${CYAN}[2]${RESET} Gestor de Duplicados ${LRED}(Interactivo)${RESET}\n"
    printf "  ${CYAN}[3]${RESET} Tweaks de Rendimiento ${YELLOW}(Experimental)${RESET}\n"
    printf "  ${CYAN}[4]${RESET} Herramientas de Desarrollador ${YELLOW}(Avanzado)${RESET}\n"
    printf "  ${CYAN}[5]${RESET} Liberador de RAM (Interactivo)\n"
    printf "  ${CYAN}[6]${RESET} Gestor de Apps\n"
    printf "  ${CYAN}[7]${RESET} Diagnóstico APEX Completo\n"
    printf "  ${CYAN}[8]${RESET} Salir\n"
    read -p "Opción: " choice

    case $choice in
        1) run_apex_cleanup ;; 2) run_duplicate_manager ;; 3) run_performance_tweaks ;; 4) run_developer_tools ;; 5) run_ram_booster ;; 6) run_app_manager ;; 7) show_apex_diagnostics ;;
        8) clear; printf "${GREEN}¡Hasta luego!${RESET}\n"; exit 0 ;; *) printf "\n${RED}Opción no válida.${RESET}\n"; sleep 1 ;;
    esac
done
FULL_APEX_EOF
)
echo "$FULL_SCRIPT" > ~/apex_optimizer.sh

chmod +x ~/apex_optimizer.sh &amp;&amp; ~/apex_optimizer.sh</textarea>
        </div>
    </div>

    <script>
        const selectButton = document.getElementById('selectButton');
        const selectButtonText = document.getElementById('selectButtonText');
        const commandContent = document.getElementById('commandContent');

        selectButton.addEventListener('click', () => {
            commandContent.focus();
            commandContent.select();
            selectButtonText.textContent = '¡Ahora Toca "Copiar" en tu Teléfono!';
            selectButton.classList.remove('bg-red-600', 'hover:bg-red-700');
            selectButton.classList.add('bg-cyan-600');
            
            setTimeout(() => {
                selectButtonText.textContent = 'Paso 1: Seleccionar el Instalador APEX';
                selectButton.classList.add('bg-red-600', 'hover:bg-red-700');
                selectButton.classList.remove('bg-cyan-600');
            }, 5000);
        });
    </script>
</body>
</html>

